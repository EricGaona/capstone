{% extends "bank/layout.html" %} 
{% load static %}
{% block title %}Profile{%endblock%} 

{% block script %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const loanForm = document.getElementById("loanForm");
        const messageDiv = document.getElementById("message");

        loanForm.addEventListener("submit", async function (event) {
            event.preventDefault();  // Prevent default form submission

            const formData = new FormData(loanForm);
            const data = Object.fromEntries(formData.entries());  // Convert form data to JSON-like object

            try {
                const response = await fetch(loanForm.action, {
                    method: "POST",
                    headers: {
                        "X-CSRFToken": formData.get("csrfmiddlewaretoken"),
                        "Content-Type": "application/x-www-form-urlencoded",
                    },
                    body: new URLSearchParams(data),  // Convert data to URL-encoded format
                });

                const result = await response.json();

                if (response.ok) {
                    messageDiv.innerHTML = `<p class="text-success">${result.message}</p>`;
                } else {
                    // messageDiv.innerHTML = `<p> entro aqui</p>`;
                  messageDiv.innerHTML = `<p class="text-danger">${result.error}</p>`;
                }
            } catch (error) {
                messageDiv.innerHTML = "<p class='text-danger'>An error occurred while submitting your loan application.</p>";
            }
        });
    });
</script>
{% endblock %}

{% block body %}

<!-- <h4 mt-5>Hello <b>{{ user_name }}</b>. This is your Loan page.</h4> -->

<div class="container mt-5 controlImages">
    <div class="row">
      <div class="col-12 col-md-6 d-flex align-items-center justify-content-center">
        <div class="text-center">
          <h2>Fill out the form and apply for a loan between $500 and $4000.</h2>
        </div>
      </div>

      <div class="col-12 col-md-6">
        <img src="{% static 'bank/images/loanIMG2.jpg' %}" alt="Placeholder Image" class="img-fluid">
      </div>
    </div>
  </div>

    <div class="container mt-5">
        <h2>Apply for a Loan</h2>
        <form id="loanForm" action="{% url 'apply_for_loan' %}" method="post">
            {% csrf_token %}
            <div class="form-group">
                <label for="amount">Loan Amount ($500 - $4000):</label>
                <input type="number" class="form-control" id="amount" name="amount" min="500" max="4000" required>
            </div>
            <div class="form-group">
                <label for="deadlines">Number of Months (Deadlines):</label>
                <input type="number" class="form-control" id="deadlines" name="deadlines" min="1" max="120" required>
            </div>
            <div class="form-group">
                <label for="income">Monthly Income (optional):</label>
                <input type="number" class="form-control" id="income" name="income" min="0">
            </div>
            <div class="form-group">
                <label for="company">Company (optional):</label>
                <input type="text" class="form-control" id="company" name="company">
            </div>
            <div class="form-group">
                <label for="time_working">Time Working (in months, optional):</label>
                <input type="number" class="form-control" id="time_working" name="time_working" min="0">
            </div>
            <button type="submit" class="btn btn-primary">Apply for Loan</button>
        </form>

        <div id="message" class="mt-4"></div>
    </div>

{% endblock %}